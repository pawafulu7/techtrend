# パフォーマンス分析

## 主要なボトルネック

### 1. N+1クエリ問題
- 多くのAPIエンドポイントで`include`や`_count`を多用
- 特に問題のある箇所：
  - `/api/sources/[id]/route.ts`: 複数の並列クエリ実行
  - ホームページ: tags、source、_countを含む大量のデータ取得

### 2. 過剰なデータ取得
- 記事一覧で毎回全フィールドを取得
- 使用しないフィールド（content, thumbnail, detailedSummary）も含まれることがある
- selectでフィールドを絞っているが、まだ最適化の余地あり

### 3. キャッシュの未活用
- 人気記事API（`/api/articles/popular`）に15分キャッシュがあるのみ
- タグクラウド、ソース一覧などの更新頻度の低いデータがキャッシュされていない
- Redis（Upstash）は導入済みだがレート制限にのみ使用

### 4. 集計処理の非効率性
- タグの使用回数カウントが毎回計算される
- 品質スコアの統計が都度計算される
- グループ化やソートがアプリケーション側で実行される場合がある

### 5. 大量データ処理
- scripts/generate-summaries.tsが一度に大量の記事を処理
- バッチ処理の並列度が適切でない可能性
- メモリ使用量の考慮不足

## 改善提案

### 短期的改善
1. 頻繁にアクセスされるデータのRedisキャッシュ導入
2. selectの最適化とincludeの削減
3. バッチ処理のチャンクサイズ最適化

### 中長期的改善
1. マテリアライズドビューの検討
2. 集計テーブルの導入
3. GraphQLによるクエリ最適化
4. Edge Functionsの活用