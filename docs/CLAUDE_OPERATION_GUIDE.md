# Claude Code統合機能 運用ガイドライン

## 概要

このガイドは、TechTrendプロジェクトにおけるClaude Code統合機能の効果的な運用方法について説明します。
Claude Codeは、既存のGemini APIと併用することで、より柔軟で高品質な要約生成を実現します。

## 使い分けガイド

### Gemini APIを使用すべきケース

1. **大量バッチ処理**
   - 100件以上の記事を一括処理する場合
   - 深夜の定期実行（スケジューラー）
   - 初期データの一括生成

2. **自動化処理**
   - CI/CDパイプライン内での処理
   - 無人環境での実行
   - APIコスト重視の運用

3. **通常運用**
   - 日常的な記事収集・要約生成
   - システムの安定運用時

### Claude Codeを使用すべきケース

1. **Rate Limit対策**
   - Gemini APIで503エラーが頻発する場合
   - 「Resource has been exhausted」エラー時
   - 緊急の要約生成が必要な場合

2. **高品質要約が必要な場合**
   - 重要な記事の要約見直し
   - より自然な日本語表現が必要な場合
   - 記事タイプに特化した要約が必要な場合

3. **インタラクティブな処理**
   - 要約内容の即時確認・修正
   - 特定記事の選択的処理
   - 品質チェックと改善

## 実行手順

### 1. Claude Codeによる要約生成

```bash
# 基本的な使用方法
npm run claude:summarize

# 処理の流れ
1. 要約未生成の記事一覧が表示される
2. 処理したい記事を選択（番号入力）
3. AIプロンプトが表示される
4. Claude Codeでプロンプトをコピー＆ペースト
5. 生成された要約・タグを入力
6. データベースに保存
```

### 2. 品質比較の実施

```bash
# 品質比較モード
npm run claude:compare

# 使用例
比較する記事数を入力してください (デフォルト: 3): 5

# 結果の確認
- 各記事でGeminiとClaudeの要約を並列表示
- 品質スコア（100点満点）で定量評価
- 処理時間の比較
```

## 運用上の注意事項

### 1. セッション管理

- Claude Codeはセッション中のみ有効
- 長時間の処理は進捗を定期的に保存
- セッション切断時は最後の記事番号をメモ

### 2. エラー対応

#### Rate Limitエラー時
```bash
# Gemini APIがRate Limitの場合
1. npm run claude:summarize を実行
2. 未処理の重要記事から順に処理
3. 1時間後にGemini APIで残りを処理
```

#### パース エラー時
```
# Claude応答のパースエラー
1. 要約とタグが正しい形式か確認
2. 要約: 60-80文字の1文
3. タグ: カンマ区切りで3-5個
```

### 3. 品質管理

#### 要約の品質チェックリスト
- [ ] 60-80文字の範囲内か
- [ ] 文末に句点（。）があるか
- [ ] 日本語として自然か
- [ ] 記事の要点を捉えているか
- [ ] 技術用語が適切か

#### タグの品質チェックリスト
- [ ] 3-5個の適切な範囲か
- [ ] 記事内容を反映しているか
- [ ] 正規化されているか（例: JS → JavaScript）
- [ ] 一般的すぎないか

## トラブルシューティング

### Q1: Claude Codeが応答しない
**A**: 
1. プロンプトが長すぎる可能性があります
2. セッションが切れている可能性があります
3. 新しいセッションで再試行してください

### Q2: 要約が保存されない
**A**:
1. 入力形式を確認（要約とタグを2行で入力）
2. データベース接続を確認
3. エラーメッセージを確認

### Q3: 品質スコアが低い
**A**:
1. 文字数制限（60-80文字）を守る
2. 句点で終わるようにする
3. タグを3-5個に調整する

## ベストプラクティス

### 1. 効率的な運用

```bash
# 朝の運用フロー
1. npm run scripts:collect    # 新記事収集
2. npm run scripts:summarize  # Gemini API実行
3. エラーが出た記事をメモ
4. npm run claude:summarize   # エラー記事をClaude処理
```

### 2. 品質向上のコツ

- **記事タイプを意識**: チュートリアル、ニュース、技術解説で異なるアプローチ
- **キーワード抽出**: 記事の核心となる技術用語を確実に含める
- **読者視点**: 「何が新しいのか」「なぜ重要なのか」を明確に

### 3. チーム運用

```markdown
## 日次レポート例
- Gemini処理: 150記事（成功率: 95%）
- Claude処理: 8記事（Rate Limit対応）
- 平均品質スコア: 82点
- 改善が必要な記事: 3件
```

## 今後の展望

### 短期的改善（1-3ヶ月）
- 文字数カウントの精度向上
- より詳細な品質評価指標
- 自動フォールバック機能

### 中期的改善（3-6ヶ月）
- Claude API統合（セッション不要化）
- 自動品質改善システム
- A/Bテストによる最適化

### 長期的展望（6ヶ月以上）
- 完全自動化されたハイブリッドシステム
- MLによる品質予測
- カスタマイズ可能な要約スタイル

## 関連ドキュメント

- [CLAUDE.md](../CLAUDE.md) - プロジェクト固有の注意事項
- [実装計画書](.claude/docs/plan/plan_20250805_claude_integration.md)
- [テスト結果](.claude/docs/test/)

---

最終更新: 2025年8月5日
作成者: Claude Code