# 空のタグ問題の調査結果

## 調査日時
2025-08-01 09:42:45

## 問題の概要
ユーザーから「未入力タグが混じっている」との報告を受け、調査を実施した結果、データベースに空の文字列（""）のタグが存在し、20記事に関連付けられていることが判明した。

## 調査結果

### 1. タグの全体状況
- 総タグ数: 1,817個
- 問題のあるタグ:
  - **空のタグ（""）: 1個（20記事に関連）**
  - 短いタグ（2文字以下）: 25個
  - 長いタグ（30文字超）: 0個
  - 特殊文字を含むタグ: 28個
  - 大文字小文字の重複: 21グループ

### 2. 空のタグの詳細
- タグID: cmdqm0w05000ntel7yxpu04b0
- 名前: ""（空文字列）
- 関連記事数: 20件

### 3. 影響を受けている記事の特徴
- **すべてAWSのWhat's New記事**
- 期間: 2025-07-29 〜 2025-07-31
- 共通パターン:
  - ソース: AWS
  - 必ず含まれるタグ: "AWS", "What's New", "新機能", "Updates"
  - 空のタグが3番目の位置に挿入されている

### 4. 原因分析

#### 根本原因
AWSフェッチャー（`lib/fetchers/aws.ts`）の`extractTags`メソッドで、RSSフィードのカテゴリ（`item.categories`）に空の文字列が含まれている場合、そのままタグとして追加されている。

```typescript
// 問題のコード（aws.ts 132-134行目）
if (item.categories && item.categories.length > 0) {
  tags.push(...item.categories);
}
```

#### なぜ発生したか
1. AWS What's NewのRSSフィードに空のカテゴリが含まれている
2. AWSフェッチャーでカテゴリを追加する際、空文字列のフィルタリングを行っていない
3. 後続の処理（generate-summaries.ts、generate-tags-only.ts）では新規タグ生成時にはフィルタリングするが、フェッチャーで設定されたタグはそのまま保存される

### 5. その他の問題

#### 大文字小文字の重複
- "AI"と"ai"（21件 vs 2件）
- "JavaScript"と"javascript"（17件 vs 1件）
- "React"と"react"（10件 vs 0件）
など、21グループの重複が存在

#### 未使用タグ
- 39個のタグが一度も使用されていない

## 修正方針

### 1. 即座の対応
1. **空のタグの削除**
   - 空のタグを全記事から切り離す
   - 空のタグをデータベースから削除する

2. **AWSフェッチャーの修正**
   - カテゴリを追加する前に空文字列をフィルタリング
   - タグの正規化処理を追加

### 2. 長期的な対応
1. **タグの統一**
   - 大文字小文字の重複を統一
   - タグ正規化ルールの強化

2. **品質管理**
   - 定期的なタグ品質チェック
   - 不適切なタグの自動検出・修正

## 技術的な推奨事項

### 修正コード例（aws.ts）
```typescript
private extractTags(item: AWSRSSItem, feedName: string): string[] {
  const tags: string[] = [];

  // カテゴリから抽出（空文字列を除外）
  if (item.categories && item.categories.length > 0) {
    const validCategories = item.categories
      .filter(cat => cat && cat.trim().length > 0);
    tags.push(...validCategories);
  }
  
  // 以下既存のコード...
}
```

## リスクと影響
- 空のタグにより、UIでの表示や検索に不具合が生じる可能性
- タグによるフィルタリング機能が正しく動作しない
- ユーザー体験の低下

## 次のステップ
1. 空のタグを削除するスクリプトの作成・実行
2. AWSフェッチャーの修正
3. 既存タグの品質改善（重複の統一など）