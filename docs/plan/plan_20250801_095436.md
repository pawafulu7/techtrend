# AWS関連タグ一括削除の実装計画（更新版）

## 計画作成日時
2025-08-01 09:54:36

## 概要
ユーザーの要望に基づき、AWS関連の冗長なタグ（「What's New」、「新機能」、「Updates」）および空のタグを一括削除する。

## 背景
調査により以下が判明：
- 空のタグ（""）、「What's New」、「新機能」、「Updates」の4つのタグがすべて同じ20記事に設定
- すべてAWSのWhat's Newフィードから取得した記事
- 4つのタグは100%共起しており、完全に冗長
- 「AWS」タグだけで記事の識別は十分可能

## 削除対象タグ
| タグ名 | タグID | 記事数 | 削除理由 |
|--------|--------|---------|----------|
| "" (空) | cmdqm0w05000ntel7yxpu04b0 | 20 | 無効なタグ |
| What's New | cmdqm0w01000mtel71douymxx | 20 | 冗長・英語表記 |
| 新機能 | cmdqm0w0d000otel7oxi30htf | 20 | 冗長 |
| Updates | cmdqm0w0n000ptel7gx2lfewf | 20 | 冗長・英語表記 |

## 実装方針

### Phase 1: 既存データのクリーンアップ
1. 4つのタグをすべて削除
2. 20記事からこれらのタグを切り離し

### Phase 2: 再発防止のためのコード修正
AWSフェッチャーを修正して、今後これらのタグが付与されないようにする。

## 詳細実装タスク

### 1. 一括タグ削除スクリプトの作成（優先度: 最高）
**新規ファイル:** `remove-aws-redundant-tags.ts`

**機能:**
```typescript
// 削除対象
const tagsToRemove = [
  { name: "", id: "cmdqm0w05000ntel7yxpu04b0" },
  { name: "What's New", id: "cmdqm0w01000mtel71douymxx" },
  { name: "新機能", id: "cmdqm0w0d000otel7oxi30htf" },
  { name: "Updates", id: "cmdqm0w0n000ptel7gx2lfewf" }
];

// 処理内容
- 各タグの存在確認
- 記事からのタグ切り離し
- タグの削除
- 処理結果の報告
```

### 2. AWSフェッチャーの修正（優先度: 高）
**修正ファイル:** `/home/tomoaki/work/techtrend/lib/fetchers/aws.ts`

#### 2.1 空文字列のフィルタリング（132-134行目）
```typescript
// 修正前
if (item.categories && item.categories.length > 0) {
  tags.push(...item.categories);
}

// 修正後
if (item.categories && item.categories.length > 0) {
  const validCategories = item.categories
    .filter(cat => cat && cat.trim().length > 0)
    .map(cat => cat.trim());
  tags.push(...validCategories);
}
```

#### 2.2 「What's New」タグの削除（74-82行目）
```typescript
// 修正前
const sourceMap: Record<string, string> = {
  'Security': 'Security Bulletins',
  'WhatsNew': "What's New",
  'Blog': 'News Blog'
};

// 修正後
const sourceMap: Record<string, string> = {
  'Security': 'Security Bulletins',
  // 'WhatsNew': "What's New", // 削除：冗長なタグ
  'Blog': 'News Blog'
};
```

#### 2.3 「新機能」と「Updates」タグの削除（137-143行目）
```typescript
// 修正前
if (feedName === 'Security') {
  tags.push('セキュリティ', 'Security');
} else if (feedName === 'WhatsNew') {
  tags.push('新機能', 'Updates');
} else if (feedName === 'Blog') {
  tags.push('ブログ', 'Blog');
}

// 修正後
if (feedName === 'Security') {
  tags.push('セキュリティ', 'Security');
} else if (feedName === 'WhatsNew') {
  // tags.push('新機能', 'Updates'); // 削除：冗長なタグ
} else if (feedName === 'Blog') {
  tags.push('ブログ', 'Blog');
}
```

## ファイル変更計画

### 新規作成
1. `/home/tomoaki/work/techtrend/scripts/remove-aws-redundant-tags.ts`
   - AWS関連の冗長タグを一括削除するスクリプト
   - 約200行程度

### 修正
1. `/home/tomoaki/work/techtrend/lib/fetchers/aws.ts`
   - 空文字列フィルタリング追加
   - 冗長なタグ付与の削除（3箇所）
   - 約15行の修正

### 削除予定（未作成のため不要）
- `remove-whats-new-tag.ts`（個別削除スクリプトは不要）

## テスト戦略

### 1. 削除前の確認
- 4つのタグの現状を記録
- 影響を受ける記事の確認

### 2. 削除後の確認
- 4つのタグが完全に削除されたことを確認
- 記事に「AWS」タグが残っていることを確認
- 他のタグ（RDS、Lambda等）が影響を受けていないことを確認

### 3. AWSフェッチャーのテスト
- 新規記事取得時に削除対象のタグが作成されないことを確認
- 有効なタグ（AWS、各サービス名）は引き続き付与されることを確認

### 4. UI確認
- タグ表示が改善されたことを確認
- 空のタグが表示されなくなったことを確認

## リスク分析と対策

### リスク1: タグによるフィルタリング機能への影響
- **影響**: 最小（冗長なタグの削除のため）
- **対策**: 「AWS」タグでの検索が可能なことを確認

### リスク2: 将来の要件変更
- **影響**: AWS新機能の識別が必要になる可能性
- **対策**: 必要に応じて「AWS新機能」等の新タグを追加可能

### リスク3: 他のソースへの影響
- **影響**: なし（AWS記事のみが対象）
- **対策**: 特になし

## 実行計画

### 実行順序
1. remove-aws-redundant-tags.ts の作成（20分）
2. スクリプトの実行（10分）
3. aws.ts の修正（10分）
4. 動作確認（10分）

### 総所要時間
約50分

## 成功基準
1. 4つのタグがデータベースから完全に削除される
2. 20記事に「AWS」タグのみが残る（サービス固有のタグは維持）
3. 新規AWS記事取得時に削除対象のタグが作成されない
4. UIでのタグ表示が簡潔になる

## 次のステップ
1. remove-aws-redundant-tags.ts の実装
2. スクリプトの実行
3. aws.ts の修正
4. 動作確認

## 前回計画からの変更点
- 「新機能」と「Updates」タグも削除対象に追加
- 個別削除スクリプトから一括削除スクリプトに変更
- AWSフェッチャーの修正箇所を3箇所に拡大

---
計画作成者: Claude Code
計画バージョン: 2.0