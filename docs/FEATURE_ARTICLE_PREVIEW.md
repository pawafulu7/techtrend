# 記事プレビュー機能 - 詳細設計書

作成日: 2025-01-29

## 1. 機能概要

### 目的
記事カードにホバーすることで、クリックする前に記事の内容を素早く把握できるようにする。

### 主な機能
- 記事カードホバー時にポップアップでプレビュー表示
- 記事本文の最初の200-300文字を表示
- メタ情報（公開日、ソース、タグ、難易度）の表示
- スムーズなアニメーション
- モバイルでは長押しでプレビュー表示

## 2. 技術設計

### 2.1 実装方式

#### アプローチ: Floating UIを使用
- ポップオーバーの位置計算とポジショニング
- ビューポート境界での自動調整
- アクセシビリティ対応

#### 代替案: Radix UI Popover
- より宣言的なAPI
- アニメーション制御が容易
- 既存のUIコンポーネントとの統一性

### 2.2 データ取得戦略

#### 方式1: 事前ロード（推奨）
- 記事リストAPIで`content`フィールドも取得
- プレビューはクライアントサイドで即座に表示
- メリット: 高速な表示
- デメリット: 初期ロードのペイロードが大きくなる

#### 方式2: 遅延ロード
- ホバー時にAPIから追加データを取得
- メリット: 初期ロードが軽い
- デメリット: プレビュー表示に遅延が発生

### 2.3 UI/UX設計

#### デスクトップ
- ホバー後300msでプレビュー表示
- マウスアウトで即座に非表示
- プレビューサイズ: 最大400px幅
- 位置: カードの右側（スペースがない場合は左側）

#### モバイル/タブレット
- 長押し（500ms）でプレビュー表示
- 背景をタップで閉じる
- フルスクリーン幅のモーダル表示

### 2.4 コンポーネント設計

```typescript
interface ArticlePreviewProps {
  article: ArticleWithRelations;
  children: React.ReactNode;
}

interface PreviewContentProps {
  article: ArticleWithRelations;
  isLoading?: boolean;
}
```

## 3. 実装計画

### Phase 1: 基本実装
1. Radix UI Popoverの導入
2. ArticlePreviewコンポーネントの作成
3. 記事カードへの統合

### Phase 2: パフォーマンス最適化
1. プレビューコンテンツのメモ化
2. 仮想化による大量記事対応
3. プリフェッチング戦略

### Phase 3: 拡張機能
1. プレビュー内でのアクション（読書リスト追加など）
2. キーボードナビゲーション
3. プレビューのカスタマイズ設定

## 4. パフォーマンス考慮事項

### 4.1 レンダリング最適化
- React.memoによる不要な再レンダリング防止
- useCallbackでイベントハンドラーをメモ化
- プレビューコンテンツの遅延レンダリング

### 4.2 メモリ管理
- 非表示時はDOMから完全に削除
- 大量の記事でもメモリリークしない設計

## 5. アクセシビリティ

- キーボードでのプレビュー表示（Enterキー）
- スクリーンリーダー対応
- aria-describedbyでプレビューとの関連付け
- フォーカストラップ

## 6. 実装チェックリスト

- [ ] Radix UI Popoverのインストール
- [ ] ArticlePreviewコンポーネントの作成
- [ ] プレビューコンテンツのフォーマット処理
- [ ] デスクトップでのホバー実装
- [ ] モバイルでの長押し実装
- [ ] アニメーションの実装
- [ ] パフォーマンステスト
- [ ] アクセシビリティテスト
- [ ] ドキュメントの更新